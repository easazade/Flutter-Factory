# pod_server

This is the starting point for your Serverpod server.

To run your server, you first need to start Postgres and Redis. It's easiest to do with Docker.

    docker compose up --build --detach

Then you can start the Serverpod server.

    dart bin/main.dart

When you are finished, you can shut down Serverpod with `Ctrl-C`, then stop Postgres and Redis.

    docker compose stop

# Tips and Tricks

to connect to postgres databse in docker run
`docker exec -it pod_server_postgres_1 psql -U postgres`

`pod_server_postgres_1` is the postgres container you can get the name from docker agent or running `docker ps` to list containers
`-U` is for the user name of the database you can get these info from `pod_server/config/development.yaml` or `docker-compose.yaml`
Database password is in docker-compose.yaml file

to connect to your database first list Dbs by `\l` then connect to it using `\c` then list tables using `\dt`
then run the command you need. to quit postgres use `\q`.

There is file that is generated by serverpod that conatins command that we should run in `postgres`.
go to `pod_server/generated/tables.pgsql` and copy the command and paste and run them in `postgres`.

---

to change servepod config like ports and stuf you can change it all in `pod_server/config/` folder for
different environments.

# Custom Serializable object

to make a class persistable you should define a model.yaml in protocol. but just to have a class that can be passed as response and request body:

create a `shared` package add it to server & client packages. create serializable models in it. they should
have toJson() and a factory fromJson().
export it in the file you want to be imported by serverpod.

add the file and model as extraClasses in `xxx_server/config/generator.yaml` like below

```yaml
extraClasses:
  - package:shared/shared.dart:Car
```

run `serverpod generate`

# Session

If you need additional information about a call, you may need to cast the Session to one of its subclasses, e.g., `MethodCallSession` or `StreamingSession`. The `MethodCallSession` object provides additional properties, such as the name of the endpoint and method and the underlying HttpRequest object.
example:

```dart
session as MethodCallSession;
var ipAddress = session.httpRequest.remoteIpAddress;
```

# Serverpod Singleton

there is a `Serverpod.instance` that has some nifty functionalities.

for example we can use `createSession` to create one manually (which we are responsible for closing it manually as well).
`session.close()`. If we don't it will cause memory leaks.
